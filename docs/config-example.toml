# Complete Configuration Example for 'start'
# This file demonstrates all configuration options and patterns.
# Location: ~/.config/start/config.toml (global) or ./.start/config.toml (local)

# ============================================================================
# Settings
# ============================================================================

[settings]
# Default agent to use when not specified
# If omitted, uses first agent defined in config (TOML order)
default_agent = "claude"

# Default role to use when not specified
# If omitted, uses first role defined in config (TOML order)
default_role = "general-assistant"

# Logging verbosity: quiet, normal, verbose, debug
log_level = "normal"

# Default shell for command execution
# Supports: bash, sh, zsh, fish, node, python, ruby, etc.
shell = "bash"

# Default timeout for command execution (seconds)
command_timeout = 30

# ============================================================================
# Agents
# ============================================================================
# Agent configurations define how to invoke AI tools.
# Pattern: [agents.<name>]
# Scope: Both global and local configs (local overrides global)

[agents.claude]
description = "Anthropic's Claude via Claude Code CLI"
url = "https://docs.claude.com/claude-code"
models_url = "https://docs.anthropic.com/en/docs/about-claude/models"
command = "claude --model {model} --append-system-prompt '{role}' '{prompt}'"
default_model = "sonnet"
# Uses {role} placeholder for inline content

  # Model aliases for this agent
  [agents.claude.models]
  haiku = "claude-3-5-haiku-20241022"
  sonnet = "claude-3-7-sonnet-20250219"
  opus = "claude-opus-4-20250514"

[agents.gemini]
description = "Google's Gemini AI via CLI"
url = "https://github.com/google-gemini/gemini-cli"
models_url = "https://ai.google.dev/models/gemini"
command = "GEMINI_SYSTEM_MD='{role_file}' gemini --model {model} --include-directories ~/reference --approval-mode default --prompt '{prompt}'"
default_model = "flash"
# Uses {role_file} placeholder - Gemini reads system prompt from file path
# Environment variable set using shell syntax in command

  [agents.gemini.models]
  flash = "gemini-2.0-flash-exp"
  pro = "gemini-2.0-pro-exp"

[agents.aichat]
description = "All-in-one multi-provider AI chat tool"
url = "https://github.com/sigoden/aichat"
command = "AICHAT_SYSTEM_PROMPT='{role}' aichat --model {model} '{prompt}'"
default_model = "gpt4-mini"
# Uses {role} placeholder for inline content
# Environment variable set using shell syntax in command

  [agents.aichat.models]
  gpt4-mini = "gpt-4o-mini"
  gpt4 = "gpt-4o"
  claude = "claude-3-5-sonnet-20241022"
  gemini = "gemini-2.0-flash-exp"

# ============================================================================
# Roles
# ============================================================================
# Role configurations define system prompts using the UTD pattern.
# Pattern: [roles.<name>]
# Scope: Both global and local configs (local overrides global)
# UTD Fields: file, command, prompt (at least one required)

# Simple role - file only
[roles.general-assistant]
description = "General purpose AI assistant"
file = "~/.config/start/roles/general-assistant.md"

# Role with file + template framing
[roles.code-reviewer]
description = "Expert code reviewer focused on quality and best practices"
file = "~/.config/start/roles/code-reviewer.md"
prompt = """
{file}

## Additional Context

Today you are reviewing code with a focus on:
- Security vulnerabilities
- Performance implications
- Maintainability and readability
- Best practices and idioms
"""

# Role with dynamic content via command
[roles.go-expert]
description = "Go language specialist and reviewer"
file = "~/.config/start/roles/go-base.md"
command = "go version 2>/dev/null || echo 'Go not installed'"
prompt = """
{file}

## Environment

{command}

Apply Go-specific best practices, idioms, and language features.
Focus on proper error handling, concurrency patterns, and interface design.
"""

# Role with file + dynamic date context
[roles.security-auditor]
description = "Security-focused code auditor"
file = "~/.config/start/roles/security-auditor.md"
command = "date '+%Y-%m-%d %H:%M:%S %Z'"
prompt = """
{file}

Security Audit Timestamp: {command}

CRITICAL SECURITY FOCUS:
- SQL injection, XSS, CSRF
- Authentication and authorization flaws
- Data exposure and information leakage
- Cryptographic weaknesses
- Input validation failures
- Dependency vulnerabilities
"""

# Role with inline prompt only
[roles.documentation-writer]
description = "Technical documentation specialist"
prompt = """
You are a technical documentation specialist with expertise in:
- Clear, concise technical writing
- Proper markdown formatting
- Code examples and snippets
- User-focused explanations
- API documentation

Guidelines:
- Use active voice and present tense
- Break complex topics into digestible sections
- Include examples for clarity
- Focus on the "why" not just the "what"
- Keep paragraphs short (3-4 lines max)
"""

# Role with command-generated content
[roles.git-context-reviewer]
description = "Code reviewer with git context awareness"
command = """
echo "Branch: $(git branch --show-current 2>/dev/null || echo 'unknown')"
echo "Last commit: $(git log -1 --format='%h - %s' 2>/dev/null || echo 'none')"
echo "Modified files: $(git status --short 2>/dev/null | wc -l | tr -d ' ')"
"""
file = "~/.config/start/roles/code-reviewer.md"
prompt = """
{file}

## Current Git Context

{command}

Consider this context when reviewing code changes.
"""

# Project-specific role (useful in local config)
[roles.project-default]
description = "Project-specific role from ROLE.md"
file = "./ROLE.md"
# Note: Relative paths resolve from working directory
# Perfect for per-project customization in ./.start/config.toml

# ============================================================================
# Context Documents
# ============================================================================
# Context documents provide background information to AI agents.
# Pattern: [context.<name>]
# Scope: Both global and local configs (combined, local adds to global)
# UTD Fields: file, command, prompt (at least one required)

[context.environment]
description = "Local development environment details"
file = "~/reference/ENVIRONMENT.md"
prompt = "Read {file} for environment context."
required = true
# Required contexts are included in 'start' and 'start task' commands

[context.index]
description = "Reference documentation index"
file = "~/reference/INDEX.csv"
prompt = "Read {file} for documentation index and available references."
required = true

[context.project]
description = "Current project context and progress"
file = "./PROJECT.md"
prompt = "Read {file} for project status, goals, and current work."
required = false
# Optional contexts only included in 'start' command (not tasks or prompt)

[context.agents-guide]
description = "Guidelines for AI agents working on this project"
file = "./AGENTS.md"
prompt = "Read {file} for important guidelines and project-specific instructions."
required = false

[context.readme]
description = "Project overview and documentation"
file = "./README.md"
prompt = "Read {file} for project overview and usage instructions."
required = false

# Context with dynamic content
[context.git-status]
description = "Current git repository status"
command = """
echo "=== Git Status ==="
git status --short 2>/dev/null || echo "Not a git repository"
echo ""
echo "=== Recent Commits ==="
git log --oneline -5 2>/dev/null || echo "No commits"
"""
prompt = """
Current repository state:

{command}
"""
required = false

# ============================================================================
# Tasks
# ============================================================================
# Tasks are predefined workflows with specific prompts and optional overrides.
# Pattern: [tasks.<name>]
# Scope: Both global and local configs (local overrides global for same name)
# UTD Fields: file, command, prompt (at least one required for task prompt)

# ----------------------------------------------------------------------------
# Simple Tasks (using defaults)
# ----------------------------------------------------------------------------

[tasks.help]
alias = "h"
description = "General help and assistance"
# No role or agent specified → uses default_role and default_agent
prompt = """
I need help with the following:

{instructions}

Please provide clear, actionable guidance.
"""

[tasks.explain]
alias = "exp"
description = "Explain a concept or piece of code"
prompt = """
Please explain the following in clear, simple terms:

{instructions}

Include examples if helpful.
"""

# ----------------------------------------------------------------------------
# Tasks with Specific Roles
# ----------------------------------------------------------------------------

[tasks.code-review]
alias = "cr"
agent = "claude"
role = "code-reviewer"
description = "General code quality review"
# Uses specified agent, no command → static prompt only
prompt = """
Please review the code in this project.

Focus areas: {instructions}

Provide specific, actionable feedback on:
- Code quality and maintainability
- Potential bugs or issues
- Best practices and improvements
"""

[tasks.security-audit]
alias = "sec"
agent = "claude"
role = "security-auditor"
description = "Security-focused code audit"
command = "git diff --staged"
prompt = """
Perform a comprehensive security audit on these changes:

```diff
{command}
```

Additional focus areas: {instructions}
"""

[tasks.doc-review]
alias = "dr"
agent = "claude"
role = "documentation-writer"
description = "Review and improve documentation"
file = "./README.md"
prompt = """
Review this documentation for clarity and completeness:

{file}

Specific improvements needed: {instructions}
"""

# ----------------------------------------------------------------------------
# Tasks with Specific Agents
# ----------------------------------------------------------------------------

[tasks.gemini-review]
alias = "gr"
agent = "gemini"
description = "Code review using Gemini for alternative perspective"
# No role specified → uses default_role
command = "git diff --staged"
prompt = """
Review these code changes from a fresh perspective:

{command}

Focus: {instructions}
"""

# ----------------------------------------------------------------------------
# Tasks with Specific Role AND Agent
# ----------------------------------------------------------------------------

[tasks.go-review]
alias = "gor"
role = "go-expert"
agent = "claude"
description = "Expert Go code review"
command = "git diff --staged -- '*.go'"
shell = "bash"
command_timeout = 15
prompt = """
Review the following Go code changes:

## Instructions
{instructions}

## Changes
```diff
{command}
```

Apply Go best practices, check for:
- Proper error handling
- Goroutine safety
- Interface usage
- Memory efficiency
- Idiomatic Go patterns
"""

[tasks.security-gemini]
alias = "secg"
role = "security-auditor"
agent = "gemini"
description = "Security audit with Gemini's perspective"
command = "git diff --staged"
prompt = """
Security audit with alternative model perspective:

{command}

Focus: {instructions}
"""

# ----------------------------------------------------------------------------
# Advanced Tasks with Dynamic Content
# ----------------------------------------------------------------------------

[tasks.git-diff-review]
alias = "gdr"
role = "git-context-reviewer"
description = "Review git diff with full context awareness"
command = "git diff --staged"
shell = "bash"
prompt = """
Review the following staged changes:

## Instructions
{instructions}

## Staged Changes
```diff
{command}
```

Consider the git context provided in the system prompt.
"""

[tasks.commit-message]
alias = "cm"
role = "code-reviewer"
description = "Generate commit message from staged changes"
command = """
git diff --staged --stat
echo "---"
git diff --staged
"""
prompt = """
Based on these staged changes, suggest a commit message:

{command}

Follow conventional commit format.
Additional context: {instructions}
"""

[tasks.test-review]
alias = "tr"
role = "go-expert"
description = "Review test coverage and quality"
command = """
echo "=== Test Files ==="
find . -name '*_test.go' -type f 2>/dev/null | head -20
echo ""
echo "=== Test Coverage ==="
go test -cover ./... 2>&1 | head -50
"""
shell = "bash"
command_timeout = 60
prompt = """
Review test coverage and quality:

{command}

Suggestions needed for: {instructions}
"""

[tasks.api-review]
alias = "api"
role = "code-reviewer"
description = "Review API design and implementation"
command = """
echo "=== API Routes ==="
rg -n "func.*Handler|router\.|Route" --type go | head -30
echo ""
echo "=== Recent API Changes ==="
git log --oneline --grep="api\|endpoint\|route" -10 2>/dev/null
"""
shell = "bash"
prompt = """
Review API design:

{command}

Focus areas: {instructions}
"""

# ----------------------------------------------------------------------------
# Documentation Tasks
# ----------------------------------------------------------------------------

[tasks.readme-update]
alias = "ru"
role = "documentation-writer"
description = "Update README.md"
file = "./README.md"
command = "git diff HEAD -- README.md 2>/dev/null || echo 'No recent changes'"
prompt = """
Current README:
{file}

Recent changes:
{command}

Updates needed: {instructions}
"""

[tasks.godoc-review]
alias = "godr"
role = "go-expert"
description = "Review Go documentation comments"
command = """
rg -n "^// [A-Z][a-z]+ (is|are|provides|returns)" --type go | head -30
"""
prompt = """
Review Go documentation comments:

{command}

Improvements: {instructions}
"""

# ----------------------------------------------------------------------------
# Quick Tasks
# ----------------------------------------------------------------------------

[tasks.quick-check]
alias = "qc"
role = "code-reviewer"
agent = "claude"
description = "Quick code check (use with --model haiku)"
command = "git diff --staged"
prompt = """
Quick review focusing on obvious issues only:

{command}

Priority: {instructions}
"""

[tasks.typo-check]
alias = "tc"
role = "documentation-writer"
description = "Check for typos and grammar"
command = "git diff --staged -- '*.md' '*.txt'"
prompt = """
Check for typos, grammar issues, and clarity:

{command}

Areas of concern: {instructions}
"""

# ============================================================================
# Notes
# ============================================================================

# Agent Selection Precedence:
# 1. --agent CLI flag (highest priority)
# 2. Task 'agent' field
# 3. default_agent setting
# 4. First agent in config (TOML order)

# Role Selection Precedence:
# 1. --role CLI flag (highest priority)
# 2. Task 'role' field
# 3. default_role setting
# 4. First role in config (TOML order)

# Model Selection Precedence:
# 1. --model CLI flag
# 2. Agent's default_model
# 3. First model in agent's models table (TOML order)

# Scope Rules:
# - Settings: Local overrides global
# - Agents: Combined (global + local), local overrides global for same name
# - Roles: Combined (global + local), local overrides global for same name
# - Context: Combined (global + local), merged
# - Tasks: Combined (global + local), local overrides global for same name

# Path Resolution:
# - Tilde (~) expands to home directory
# - Relative paths in global config: relative to home or config directory
# - Relative paths in local config: relative to working directory
# - Absolute paths: used as-is

# UTD Pattern (Unified Template Design):
# All sections using UTD support: file, command, prompt
# - file: Path to content file
# - command: Shell command to generate dynamic content
# - prompt: Template with {file} and {command} placeholders
# At least one field required, can combine all three

# Global Placeholders (available in agent commands):
# - {model} - Current model name
# - {date} - Current timestamp (ISO 8601)
# - {prompt} - Assembled prompt text
# - {role} - Resolved role content (inline text, after UTD processing)
# - {role_file} - File path to role content

# Role Placeholder Details:
# - {role}: Use for agents that accept inline content (Claude, aichat)
# - {role_file}: Use for agents that need file paths (Gemini)
# - Simple role (file only): {role_file} points to original file
# - UTD role (file+command+prompt): {role_file} points to temp file with resolved content
# - Temp files are auto-created and cleaned up after agent execution

# Task-Specific Placeholders (in task prompts):
# - {instructions} - Command-line arguments (or "None")
# - {command} - Output from task command (or empty string)
# - {file} - Content from task file (or empty string)

# Environment Variables in Agent Commands:
# - Use shell syntax: VAR=value command
# - Example: GEMINI_SYSTEM_MD='{role_file}' gemini --model {model} ...
# - Multiple vars: VAR1=a VAR2=b command
# - No separate [agents.<name>.env] section needed
